<div class="content">
<div id="request">
  <div class="row" id="edit-label">
    <div class="col-md-10 text-center"><h1>Заявка <%= @request.id %></h1></div>
  </div>

  <%= form_for(@request, remote: true, :html => {:class => "form-horizontal"}) do |f| %>
    <div class="row">
      <div class="col-md-6">
        <div class="form-group">
          <%= f.label :registrar_name, "Регистратор", :class => "col-sm-4 text-right" %>
          <div class="col-sm-8 text-left" id="registrar_name"><%= @request.registrar.name %></div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="form-group">
          <%= f.label :request_type, "Тип заявки", :class => "col-sm-4 text-right" %>
          <div class="col-sm-8 text-left" id="request_type"><%= Request.request_types[@request.request_type.to_sym] %></div>
        </div>
        <% if @request.request_type == :phone %>
        <div class="form-group">
          <%= f.label :phone, "Телефон", :class => "col-sm-4 text-right" %>
          <div class="col-sm-8 text-left" id="phone"><%= @request.phone %></div>
        </div>
        <% end %>
      </div>
    </div>
    
    <div class="form-group">
      <%= f.label :machine_id, "Автомат", :class => "col-sm-2 control-label" %>
      <div class="col-sm-10">
        <%= f.select :machine_id, options_for_select(Machine.all.collect {|m| [ m.name, m.id ] }, :selected => @request.machine_id ), {}, { :class => "form-control" } %>
      </div>
    </div>
    <div class="form-group">
      <%= f.label :description, "Описание", :class => "col-sm-2 control-label" %>
      <div class="col-sm-10">
        <%= f.text_field :description, :class => "form-control" %>
      </div>
    </div>

    <div class="text-center"><%= f.submit "Подтвердить", class: "btn btn-primary" %></div>
  <% end %> 

  <br>

  <div class="row">
    <% if @request.request_messages.size != 0 %>
    <div class="col-md-4">
      <table class="table table-striped table-hover table-condensed table-bordered">
        <thead>
          <tr><th>Сигналы</th></tr>
        </thead>
        <tbody>
          <% @request.request_messages.each do |message| %>
          <tr><td> <%= message.message.name %> </td></tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <% end %>

    <% if @request.request_tasks.size != 0 %>
    <div class="col-md-4">
      <table class="table table-striped table-hover table-condensed table-bordered">
        <thead>
          <tr><th><%= link_to 'Поручения', request_tasks_path(:request_id => @request.id) %></th></tr>
        </thead>
        <tbody>
          <% @request.request_tasks.each do |task| %>
          <tr><td> <%= task.task.name %> </td></tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <% end %>
  </div> 
</div>
</div>
