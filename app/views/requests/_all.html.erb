<script type="text/javascript"> 
  var allRequestsTemplate;

  $(document).ready(function() {
    allRequestsTemplate = new AllRequestsTemplate();

    allRequestsTemplate.init(<%= raw (@requests.map{ |r| r.getFullInfo }).to_json %>);
    allRequestsTemplate.parmDeleteActionSelector("a[data-remote].delete");
    allRequestsTemplate.parmTableSelector("#requests-table-container");
    allRequestsTemplate.parmEditFormSelector("#request_edit");
    allRequestsTemplate.parmExtractingSelector("#request");

    allRequestsTemplate.setEditAction();
  });
</script>

<h1 style="display: inline-block;">Заявки, где я
<%= form_tag(requests_path, method: "get", :style => "display: inline-block;") do %>
<div class="btn-group" data-toggle="buttons">
  <label class="btn btn-link btn-lg <%= @who_am_i.include?("registrar") ? "active" : "" %>">
    <%= check_box_tag 'who_am_i[]', "registrar", @who_am_i.include?("registrar"), :class => "display-none" %> Регистратор,
  </label>
  <label class="btn btn-link btn-lg <%= @who_am_i.include?("solver") ? "active" : "" %>">
    <%= check_box_tag 'who_am_i[]', "solver", (@who_am_i.include? "solver"), :class => "display-none" %> Решатель
  </label>
</div>
<%= submit_tag("Применить", class: "btn btn-default") %>
<% end %></h1>
<br>

<%= form_tag('request_group_destroy', :remote => true, :method => :post) do %>
<div class="btn-group" style="margin-bottom: 15px;">
  <button type="button" class="btn btn-default" data-toggle="modal" data-target="#newModal">Создать</button>
  <%= submit_tag "Удалить", :class => "btn btn-default" %>
</div>

<div id="requests-table-container" class="table-responsive standart-table-container">
<table id="requests-table" class="table table-striped table-hover table-condensed table-bordered table-autosort">
  <thead>
    <tr>
      <th></th>
      <th class="table-sortable:numeric table-sortable">Номер</th>
      <th class="table-sortable:default table-sortable">Регистратор</th>
      <th class="table-sortable:default table-sortable">Решатель</th>
      <th class="table-sortable:default table-sortable">Автомат</th>
      <th class="table-sortable:default table-sortable">Описание</th>
      <th class="table-sortable:default table-sortable">Тип</th>
    </tr>
    <tr>
      <th></th>
      <th><input class="form-control" type="text" onkeyup="Table.filter(this,this)"></th>
      <th><input class="form-control" type="text" onkeyup="Table.filter(this,this)"></th>
      <th><input class="form-control" type="text" onkeyup="Table.filter(this,this)"></th>
      <th><input class="form-control" type="text" onkeyup="Table.filter(this,this)"></th>
      <th><input class="form-control" type="text" onkeyup="Table.filter(this,this)"></th>
      <th>
        <select class="form-control" onchange="Table.filter(this,this)">
        <option value>Все</option>
        <%= options_for_select(Request.request_types.map { |k, v| [ v, v ] }) %>
        </select>
      </th>
    </tr>
  </thead>

  <tbody id ="requests">
    <% @requests.each do |request| %>
      <tr id="<%= request.id %>" data-link="<%= edit_request_path(request) %>">
        <td class="actions">
          <%= check_box_tag 'for_destroy[]', request.id, false %>
        </td>
        <td><%= request.id %></td>
        <td><%= request.registrar.name %></td>
        <td><%= request.solver.name %></td>
        <td><%= link_to request.machine.name, machine_path(request.machine) %></td>
        <td><%= request.description %></td>
        <td><%= Request.request_types[request.request_type.to_sym] %></td>
      </tr>
    <% end %>
  </tbody>
</table>

</div>
<% end %>

<div id="request_edit" class="displacer"></div> 