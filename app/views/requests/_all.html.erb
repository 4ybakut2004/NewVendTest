<script type="text/javascript"> 
  $(document).ready(function() {
    var filterForm = $('#filter-form');
    filterForm.find('input[type="checkbox"]').bind('change', function(){
      filterForm.submit();
    });
  });
</script>


<h1 style="display: inline-block;">Заявки, где я:
<%= form_tag(requests_path, method: "get", :style => "display: inline-block;", :id => "filter-form") do %>
<div class="btn-group" data-toggle="buttons">
  <label class="btn btn-link btn-lg <%= @who_am_i.include?("registrar") ? "active" : "" %>">
    <%= check_box_tag 'who_am_i[]', "registrar", @who_am_i.include?("registrar"), :class => "display-none" %> Регистратор
  </label>
</div>
<% end %></h1>
<br>

<div class="btn-group" style="margin-bottom: 15px;">
  <button type="button" class="btn btn-default" data-toggle="modal" data-target="#newRequest" ng-click="resetNewRequest()">Создать</button>
  <button type="button" class="btn btn-default" ng-click="deleteRequests()">Удалить</button>
</div>

<div class="table-responsive standart-table-container" ng-show="!editing">
<table class="table table-striped table-hover table-condensed table-bordered">
  <thead>
    <tr>
      <th></th>
      <th>Номер</th>
      <th>Регистратор</th>
      <th>Автомат</th>
      <th>Описание</th>
      <th>Тип</th>
    </tr>
    <tr>
      <td></td>
      <td><input ng-model="search.id" class="form-control" placeholder="Поиск по номеру"></td>
      <td><input ng-model="search.registrar_name" class="form-control" placeholder="Поиск по регистратору"></td>
      <td><input ng-model="search.machine_name" class="form-control" placeholder="Поиск по автомату"></td>
      <td><input ng-model="search.description" class="form-control" placeholder="Поиск по описанию"></td>
      <td><input ng-model="search.request_type_name" class="form-control" placeholder="Поиск по типу"></td>
    </tr>
  </thead>

  <tbody>
    <tr ng-repeat="request in requests | filter:search">
      <td><input type="checkbox" ng-model="request.checked"></td>
      <td ng-click="clickRequest($index)">{{request.id}}</td>
      <td ng-click="clickRequest($index)">{{request.registrar_name}}</td>
      <td ng-click="clickRequest($index)">{{request.machine_name}}</td>
      <td ng-click="clickRequest($index)">{{request.description}}</td>
      <td ng-click="clickRequest($index)">{{request.request_type_name}}</td>
    </tr>
  </tbody>
</table>
</div>