<script type="text/javascript"> 
  $(document).ready(function() {
    var filterForm = $('#filter-form');
    filterForm.find('input[type="checkbox"]').bind('change', function(){
      filterForm.submit();
    });
  });
</script>

<%= form_tag(request_tasks_path, method: "get", :style => "display: inline-block;", :id => "filter-form") do %>
<h1 style="display: inline-block;">Поручения, где я:
<div class="btn-group" data-toggle="buttons">
  <label class="btn btn-link btn-lg <%= @who_am_i.include?("assigner") ? "active" : "" %>">
    <%= check_box_tag 'who_am_i[]', "assigner", @who_am_i.include?("assigner"), :class => "display-none" %> Назначатель,
  </label>
  <label class="btn btn-link btn-lg <%= @who_am_i.include?("executor") ? "active" : "" %>">
    <%= check_box_tag 'who_am_i[]', "executor", (@who_am_i.include? "executor"), :class => "display-none" %> Исполнитель,
  </label>
  <label class='btn btn-link btn-lg <%= @who_am_i.include?("auditor") ? "active" : "" %>'>
    <%= check_box_tag 'who_am_i[]', "auditor", (@who_am_i.include? "auditor"), :class => "display-none" %> Контролер
  </label>
</div>
</h1>
<br>

<h1 style="display: inline-block;">Которые:
<div class="btn-group" data-toggle="buttons">
  <label class="btn btn-link btn-lg <%= @overdued.include?("done") ? "active" : "" %>">
    <%= check_box_tag 'overdued[]', "done", @overdued.include?("done"), :class => "display-none" %> Просрочены и сделаны,
  </label>
  <label class="btn btn-link btn-lg <%= @overdued.include?("not_done") ? "active" : "" %>">
    <%= check_box_tag 'overdued[]', "not_done", (@overdued.include? "not_done"), :class => "display-none" %> Просрочены и не сделаны
  </label>
</div>
<% end %></h1>

<div class="table-responsive standart-table-container" ng-show="!editing">
<table class="table table-striped table-hover table-condensed table-bordered">
  <thead>
    <tr>
      <th>Номер</th>
      <th>Тип</th>
      <th>Назначатель</th>
      <th>Исполнитель</th>
      <th>Контролер</th>
      <th>Описание</th>
      <th>Дата создания</th>
      <th>Плановая дата</th>
      <th>Дата выполнения</th>
      <th>Дата проверки</th>
    </tr>
    <tr>
      <td><input ng-model="search.id" class="form-control" placeholder="Поиск по номеру"></td>
      <td><input ng-model="search.task_name" class="form-control" placeholder="Поиск по типу"></td>
      <td><input ng-model="search.assigner_name" class="form-control" placeholder="Поиск по назначателю"></td>
      <td><input ng-model="search.executor_name" class="form-control" placeholder="Поиск по иполнителю"></td>
      <td><input ng-model="search.auditor_name" class="form-control" placeholder="Поиск по контролеру"></td>
      <td><input ng-model="search.description" class="form-control" placeholder="Поиск по описанию"></td>
      <td><input ng-model="search.creation_date" class="form-control" placeholder="Поиск по дате создания"></td>
      <td><input ng-model="search.deadline_date" class="form-control" placeholder="Поиск по плановому сроку"></td>
      <td><input ng-model="search.execution_date" class="form-control" placeholder="Поиск по дате выполнения"></td>
      <td><input ng-model="search.audition_date" class="form-control" placeholder="Поиск по дате проверки"></td>
    </tr>
  </thead>

  <tbody>
    <tr ng-repeat="requestTask in requestTasks | filter:search">
      <td ng-click="clickRequestTask($index)">{{requestTask.id}}</td>
      <td ng-click="clickRequestTask($index)">{{requestTask.task_name}}</td>
      <td ng-click="clickRequestTask($index)">{{requestTask.assigner_name}}</td>
      <td ng-click="clickRequestTask($index)">{{requestTask.executor_name}}</td>
      <td ng-click="clickRequestTask($index)">{{requestTask.auditor_name}}</td>
      <td ng-click="clickRequestTask($index)">{{requestTask.description}}</td>
      <td ng-click="clickRequestTask($index)">{{formattedDate(requestTask.creation_date)}}</td>
      <td ng-click="clickRequestTask($index)">{{formattedDate(requestTask.deadline_date)}}</td>
      <td ng-click="clickRequestTask($index)">{{formattedDate(requestTask.execution_date)}}</td>
      <td ng-click="clickRequestTask($index)">{{formattedDate(requestTask.audition_date)}}</td>
    </tr>
  </tbody>
</table>
</div>